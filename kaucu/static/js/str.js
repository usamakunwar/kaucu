var storage=firebase.storage();function fileUploader(e){console.log(e),0!=e.files.length&&(new FileActive(e.name).start(),""==passengerId&&save(),checkFileSize(e.files[0].size,function(n){n?getFileDimensions(e.files[0],function(n,o){var t={};t.documentType=e.name,t.extn=e.files[0].name.split(".").pop(),t.fileType="image",t.width=n,t.height=o,console.log(t),getFileID(function(n){t.id=n,uploadFile(e,t,fileUploadCallBack)})}):(new FileActive(e.name).stop(),showAlert("File size too big","Maximum file size allowed is 4MB",!0))}))}function uploadFile(e,n,o){console.log("Uploading File "+passengerId);var t=e.files[0],i=fileStorageRef(passengerId,n).put(t);new FileActive(e.name).upload(),i.on(firebase.storage.TaskEvent.STATE_CHANGED,function(n){var o=n.bytesTransferred/n.totalBytes*100;new FileActive(e.name).progress(Math.round(o))},function(n){console.log("Error "+n.code),new FileActive(e.name).stop(),showAlert("Error","Check your internet connection "+n.code,!0)},function(){console.log("Uploaded a blob or file!"),"pdf"==n.extn?(new FileActive(e.name).converting(),pdf2Image(passengerId,n.documentType,function(t,i){t?(console.log("Error "+t),new FileActive(e.name).stop(),showAlert("Error","Could not convert PDF "+t,!0)):(console.log("RESULT "+i.width+" "+i.height+" "+i.extn),n.extn=i.extn,n.width=i.width,n.height=i.height,o(n))})):o(n)})}function pdf2Image(e,n,o){console.log("PDF 2 Image Starts");var t={};t.clientId=firebase.auth().currentUser.uid,t.passengerId=e,t.documentType=n,$.ajax({url:"/pdf2image",type:"POST",data:t,success:function(e){o(null,e)},error:function(e){o(e,null)}})}function fileURL(e,n,o){fileStorageRef(e,n).getDownloadURL().then(function(e){null==e&&console.log("ERROR "+e),console.log(e),o(e)})}function fileStorageRef(e,n){return storage.ref(firebase.auth().currentUser.uid).child(e).child(e+"_"+n.documentType+"."+n.extn)}function fileStoragePath(e,n){return firebase.auth().currentUser.uid+"/"+e+"/"+e+"_"+n.documentType+"."+n.extn}storage.setMaxUploadRetryTime(1e3);